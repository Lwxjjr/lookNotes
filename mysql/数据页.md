# MySQL 数据排放的「三层完整层级」
```
================================================================
【 MySQL InnoDB 数据排放 三层完整层级（磁盘物理结构）】
【 从大到小：表空间文件 → 区 → 页 → 行 】
================================================================
┌─────────────────────────────────────────────────────────┐
│ 磁盘上的物理文件：xxx.ibd （表空间文件，存整表数据+索引）   │ ← 第一层：表空间
└─────────────────────────────────────────────────────────┘
                ↓ 内部划分为多个「区」
┌─────────────────────────────────────────────────────────┐
│ 区(Extent)：固定大小 1MB = 连续的 64 个「页」             │ ← 第二层：区
│ （作用：减少磁盘碎片，让连续的页存在一起，加速读取）         │
└─────────────────────────────────────────────────────────┘
                ↓ 每个区包含64个连续的「页」
┌─────────────────────────────────────────────────────────┐
│ 页(Page)：固定大小 16KB = 存放N条「数据行」                │ ← 第三层：页（核心单位）
└─────────────────────────────────────────────────────────┘
                ↓ 每个页内部存放排序好的「数据行」
┌─────────────────────────────────────────────────────────┐
│ 数据行(Row)：id/name/age 等真实业务字段                   │ ← 最终：数据行
└─────────────────────────────────────────────────────────┘
```

---
# InnoDB如何存储数据
记录是按照==「行」==来存储的  
数据库的读取并==不以「行」==为单位  
InnoDB的数据是以==「数据页」==为单位来读写的（默认大小为16KB）  
数据页结构：

![[243b1466779a9e107ae3ef0155604a17.webp|450]]

这7个部分的作用：
![[fabd6dadd61a0aa342d7107213955a72.webp|625]]
## File Header
File Header有2个指针，分别指向上一个数据页和下一个数据页，==让数据页在逻辑上连续==  
![[557d17e05ce90f18591c2305871af665.webp]]

## User Records
==**数据页中的记录按照「主键」顺序组成单向链表**==  
数据页中有一个==**页目录**==，起到记录的索引作用  
- 页目录由多个槽（slot）组成
- 槽是分组记录的索引（**槽对应的值都是这个组的主键最大的记录**）
- 记录按照「主键值」从小到大排序

==通过槽查找记录时==：
1. 可以使用二分法快速定位要查询的记录在哪个槽，
2. 再遍历槽内所有记录，找到对应记录

InnoDB 对每个分组中的记录条数都是有规定的，槽内的记录就只有几条：
- 第一个分组中的记录只能有 1 条记录；
- 最后一个分组中的记录条数范围只能在 1-8 条之间；
- 剩下的分组中记录条数范围只能在 4-8 条之间

![[261011d237bec993821aa198b97ae8ce.webp|625]]



---
# B+ 树是如何进行查询的？
采用B+树：为了解决当有大量记录时，存在多个数据页，能方便定位到记录所在的页  
InnoDB 里的 B+ 树中的==**每个节点都是一个数据页**==  
- 叶子节点：存放数据
- 非叶子节点：存放目录项作为索引
![[7c635d682bd3cdc421bb9eea33a5a413 1.webp]]